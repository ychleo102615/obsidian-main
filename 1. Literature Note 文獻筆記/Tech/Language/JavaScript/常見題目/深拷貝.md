---
tags: []
date: 2026-01-26
time: 14:36
---

```js
function deepCone(obj) {
	if (obj === null || typeof obj !== 'object') return obj
	
	const copy = Array.isArray(obj) ? [] : {}
	for (let key in obj) {
		// 風險：obj 可能覆寫了 hasOwnProperty
		if (Object.prototype.hasOwnProperty.call(obj, key)) {
		copy[key] = deepCone(obj[key])
	}
	
	return copy
}
```


```js
function deepClone(obj, cache = new WeakMap()) {
  if (obj === null || typeof obj !== 'object') return obj;
  
  // 處理循環引用
  if (cache.has(obj)) return cache.get(obj);
  
  // 處理特殊物件
  if (obj instanceof Date) return new Date(obj);
  if (obj instanceof RegExp) return new RegExp(obj);
  
  const copy = Array.isArray(obj) ? [] : {};
  cache.set(obj, copy);  // 先存入 cache
  
  for (let key in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, key)) {
      copy[key] = deepClone(obj[key], cache);
    }
  }
  
  return copy;
}
```