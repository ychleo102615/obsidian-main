---
tags: []
date: 2026-01-25
time: 14:52
---

### 什麼是非同步操作

`setTimeout`：macrotask，延遲後操作
`Promise.then`：microtask ，同步後立即操作
`async/await`：Promise 語法糖
`queueMicrotask`：手動加入 microtask queue

### 瀏覽器的事件循環 Event Loop

#### requestAnimationFrame
1. 同步程式
2. microtasks
3. requestAnimationFrame
4. 瀏覽器渲染
5. microtask


### Node.js 事件循環

1. timers `setTimeout` / `setInterval`
2. pending callbacks
3. idle, prepare
4. poll  I/O 事件
5. check 執行 `setImmediate`
6. close callbacks：像是 `socket.on('close')`

`process.nextTick` 優先於所有 microtask


```js

// I/O callback 中，順序固定
const fs = require('fs');
fs.readFile(__filename, () => {
	setTimeout(() => console.log('timeout'))
	setImmediate(() => console.log('immediate'))
})
// output: immediate -> timeout


// 直接執行，順序不固定
setTimeout(() => console.log('timeout'), 0)
setImmediate(() => console.log('immediate'))
// output 不固定

```