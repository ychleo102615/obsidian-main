---
tags: []
date: 2025-06-01
time: 17:41
---
ä¸Šä¸€ç« çš„Batch Processingé©åˆç”¨ä¾†å»ºç«‹æœå°‹ç´¢å¼•ã€æ¨è–¦ç³»çµ±ã€åˆ†æ...ã€‚ä½†ä»–çš„inputæ˜¯å›ºå®šçš„Boundedã€‚

Stream processingä»£è¡¨æ¯éš”ä¸€æ®µæ™‚é–“ï¼Œæˆ–æ˜¯äº‹ä»¶ç™¼ç”Ÿæ™‚ï¼Œå°±é€²è¡Œbatch processingè™•ç†ã€‚

## Transmitting Event Streams

äº‹ä»¶æ˜¯ç¨®immutable, åŒ…å«æ™‚é–“è³‡è¨Šçš„è³‡æ–™ï¼Œå¯ä»¥è¢«ç·¨ç¢¼æˆJSONæˆ–æ˜¯binaryã€‚

äº‹ä»¶æœƒæœ‰é€šçŸ¥è€…ä»¥åŠè¨‚é–±è€…ã€‚æœ€å¥½çš„æ–¹å¼æ˜¯è¨‚é–±è€…åœ¨æ”¶åˆ°äº‹ä»¶æ™‚è¢«é€šçŸ¥ï¼Œè€Œä¸æ˜¯è¨‚é–±è€…ä¸æ–·åœ°å»æª¢æŸ¥æ˜¯å¦æœ‰æ›´æ–°ã€‚

### Messaging Systems

messaging systemså…è¨±å¤šå€‹é€šçŸ¥è€…ä»¥åŠè¨‚é–±è€…åœ¨åŒä¸€å€‹ä¸»é¡Œä¸Šã€‚

æ³¨æ„çš„é»ï¼š
1. å¦‚æœé€šçŸ¥è€…ç”Ÿç”¢çš„é€Ÿåº¦å¿«æ–¼è¨‚é–±è€…æ¶ˆåŒ–çš„é€Ÿåº¦æœƒæ€éº¼æ¨£ï¼Ÿqueueå¤ªå¤§æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿå¯«å…¥diskæœƒä¸æœƒé€ æˆæ•ˆèƒ½å•é¡Œï¼Ÿ
2. ç¯€é»å¤±æ•ˆæ™‚ï¼Œè¨Šæ¯æœƒæ€éº¼æ¨£ï¼Ÿ

#### Direct messaging from producers to consumers
é€™å€‹æ©Ÿåˆ¶çš„fault tolerant åŸºæœ¬ä¸Šé åµæ¸¬èˆ‡é‡æ–°å‚³é€ï¼ˆprotocol detect and retransmitting packetsï¼‰ï¼Œä½†é€™éº¼åšçš„å‰æéƒ½æ˜¯å‡è¨­producer, consumeréƒ½åœ¨ç·šä¸Šã€‚

è‹¥consumeræ²’æ”¶åˆ°ï¼Œéœ€ä»°è³´produceré‡æ–°ç™¼é€ï¼Œæ­¤æ™‚producer crashçš„è©±ï¼Œå°±æœƒå¤±å»éœ€è¦é‡å‚³çš„å°åŒ…ã€‚

#### Message brokers
åŸºæœ¬ä¸Šæ˜¯ä¸€å€‹å°ˆé–€ç‚ºäº†è™•ç†message queueè€Œå­˜åœ¨çš„databaseã€‚é‹ä½œçš„æ–¹å¼åƒæ˜¯serverï¼Œproducer, consumeréƒ½æ˜¯ä»–çš„clientsã€‚

#### Message brokers compared to databases
æœ‰äº›message brokerç”šè‡³å¯ä»¥åƒèˆ‡å…©éšæ®µæäº¤ã€‚é€™è®“ä»–èˆ‡databaseå¾ˆåƒï¼Œä½†é‚„æ˜¯æœ‰äº›å·®ç•°ï¼š

1. databaseä¸æœƒè‡ªå‹•åˆªé™¤è³‡æ–™ï¼Œmessage brokeråœ¨ç¢ºèªå‚³é€å¾Œå°±æœƒåˆª
2. ç‚ºäº†é¿å…å›  consumer è™•ç†å¤ªæ…¢ è€Œå°è‡´ æ•´é«”ååé‡ä¸‹é™ï¼Œæˆ‘å€‘å‚¾å‘æ–¼è¨­è¨ˆä¸¦ç¶­æŒ message broker çš„ working setï¼ˆå·¥ä½œé›†ï¼‰è¼ƒå°ï¼Œä¹Ÿå°±æ˜¯è®“è¨Šæ¯å„˜å¿«è¢«æ¶ˆè²»ï¼Œä¸åœ¨ç³»çµ±ä¸­ç´¯ç©
3. éæ¿¾ã€æœå°‹æ–¹å¼ä¸åŒ
4. databaseå¯èƒ½å®¹è¨±è³‡æ–™éæ™‚ï¼Œmessage brokerå‰‡æœƒé€šçŸ¥clientsæœ‰æ–°è³‡æ–™

#### Multiple consumers

##### Load balancing
message brokeræŒ‘ä¸€å€‹consumerå‚³é€è¨Šæ¯ã€‚
åˆç¨±shared subscriptionã€‚

##### Fan-out
ç™¼é€çµ¦æ‰€æœ‰è¨‚é–±è€…

é€™å…©ç¨®æ¨¡å¼å¯ä»¥ä¸¦ç”¨ï¼Œä¾‹å¦‚ABå…©å€‹groupï¼Œè¨Šæ¯æœƒé€çµ¦æ¯å€‹groupï¼Œä½†groupä¸­åªæœ‰ä¸€å€‹clientæ”¶åˆ°è¨Šæ¯ã€‚


#### Acknowledgments and redelivery
client ack broker æ”¶åˆ°ä¹‹å¾Œï¼Œæ‰å¯å¾queueåˆªé™¤ã€‚
åœ¨load balancingæœƒæœ‰å€‹æœ‰è¶£çš„å•é¡Œï¼Œå°è‡´message æŠµé”çš„é †åºä¸å¦‚é æœŸã€‚å¦‚æœbrokerå°æ¯å€‹consumerå€‹åˆ¥ç®¡ç†çš„è©±å‰‡ä¸æœƒå‡ºç¾é€™å€‹å•é¡Œã€‚

### Partitioned Logs
log based message brokerï¼Œæƒ³è¦ä¿æœ‰æŒä¹…æ€§ç´€éŒ„ä»¥åŠä½å»¶é²çš„é€šçŸ¥ã€‚

#### Using logs for message storage

brokerçš„åˆ†å€ï¼Œç´€éŒ„logçš„æ™‚å€™ä¹Ÿæœƒæœ‰offsetï¼Œé€™å€‹offsetåªæœƒéå¢ã€‚åˆ†å€ä¹‹é–“å½¼æ­¤äº’ä¸å½±éŸ¿ã€‚
è—‰ç”±åˆ†å€ï¼Œå³ä½¿è¦å¯«å…¥diskä¹Ÿèƒ½ç¶­æŒé«˜ååé‡ã€‚

#### Logs compared to traditional messaging
|ç‰¹æ€§|Log-basedï¼ˆå¦‚ Kafkaï¼‰|å‚³çµ± messagingï¼ˆå¦‚ JMS, AMQPï¼‰|
|---|---|---|
|**fan-out æ”¯æ´**|âœ… å¤©ç”Ÿæ”¯æ´ï¼ˆè¨Šæ¯ä¸æœƒè¢«åˆªé™¤ï¼Œèª°éƒ½å¯ä»¥è®€ï¼‰|âœ… éœ€é  topic/subscription æ”¯æ´|
|**è¨Šæ¯æœƒåˆªé™¤å—ï¼Ÿ**|âŒ ä¸æœƒï¼Œä¿ç•™åœ¨ log è£¡|âœ… è®€å®Œæœƒåˆªé™¤|
|**å¹³è¡ŒåŒ–ç­–ç•¥**|**ä¾ partition åˆ†é…çµ¦ consumer**ï¼ˆç²’åº¦ç²—ï¼‰|**æ¯ç­†è¨Šæ¯å¯å–®ç¨åˆ†é…**ï¼ˆç²’åº¦ç´°ï¼‰|
|**æœ€å¤šæ¶ˆè²»è€…æ•¸é‡**|â‰¤ partition æ•¸|ä¸é™ï¼Œå¯ä»»æ„ fan-out|
|**è¨Šæ¯è™•ç†é †åº**|âœ… æ¯å€‹ partition å…§ä¿è­‰é †åº|âŒ é †åºä¸ä¿è­‰æˆ–éœ€é¡å¤–è¨­è¨ˆ|
|**è™•ç†æ…¢çš„è¨Šæ¯å½±éŸ¿ï¼Ÿ**|âŒ æœ‰ head-of-line blockingï¼ˆæ•´å€‹ partition å¡ä½ï¼‰|âœ… ä¸ä¸€å®šå¡ä½å…¶ä»–è¨Šæ¯|
|**é©ç”¨å ´æ™¯**|é«˜ååã€å¿«è¨Šæ¯ã€é‡è¦–é †åº|å–®ç­†è™•ç†é‡ã€éœ€ç´°ç·»æ§åˆ¶ã€é †åºä¸é‡è¦|

Kafka é™åˆ¶ä¸€å€‹ partition åªèƒ½è¢«ä¸€å€‹ consumerï¼ˆåŒä¸€ groupï¼‰è®€ï¼Œæ˜¯ç‚ºäº†ã€Œ**é †åºä¸€è‡´æ€§**ã€çš„ä¿è­‰ã€‚

#### Consumer offsets
brokeråªéœ€è¦è¨˜ä½clientæœ€å¾Œè®€åˆ°çš„offsetæ˜¯å¤šå°‘ï¼Œä¸éœ€è¦è¿½è¹¤æ‰€æœ‰è¨Šæ¯çš„ackã€‚

#### Disk space usage
circular bufferçš„æ¦‚å¿µï¼Œdiskå¤šå¤§ï¼Œé€™æ®µç·©è¡å°±å¤šå¤§ã€‚
consumerå¤ªæ…¢æœƒéŒ¯éè³‡æ–™ã€‚

#### When consumers cannot keep up with producers
disk bufferèƒ½å¤ çˆ­å–æ™‚é–“ä»¥äººç‚ºä¿®å¾©slow consumer
ä¸¦ä¸”å°±ç®—consumerè½å¾Œäº†å¾ˆå¤šï¼ˆcrashäº†)ï¼Œä¹Ÿä¸å¿…æ“”å¿ƒé€™æœƒå½±éŸ¿ broker serviceã€‚

#### Replaying old messages
Log-based broker æä¾›äº†åƒæª”æ¡ˆä¸€æ¨£å¯é‡æ’­çš„è¨Šæ¯è¨˜éŒ„ï¼Œè®“ä½ å¯ä»¥å›æº¯ã€é‡è©¦ã€åšå¯¦é©—ï¼Œé€™è®“è³‡æ–™æ•´åˆã€éŒ¯èª¤ä¿®å¾©è®Šå¾—æ›´å®¹æ˜“ã€‚


## Databases and Streams

Databaseä¹Ÿèƒ½åƒè€ƒä¸€ä¸‹message brokerã€‚

replication logå°±æ˜¯databaseå°‡leaderçš„å¯«å…¥åŒ–ç‚ºäº‹ä»¶ã€‚
Total Order Broadcastå‰‡æ˜¯åœ¨æè¿°ï¼Œæˆ‘å€‘èƒ½å¤ é€éæœ‰é †åºçš„eventsä½¿replicaèˆ‡æºé ­ä¸€è‡´ã€‚

### Keeping Systems in Sync
![700](https://github.com/Vonng/ddia/raw/main/img/fig11-4.png)

### Change Data Capture (CDC)
![700](https://github.com/Vonng/ddia/raw/main/img/fig11-5.png)
The search index and any other derived data systems are just consumers of the change stream

#### Implementing change data capture
#### Initial snapshot
#### Log compaction
#### API support for change streams

### Event Sourcing
Event Sourcing æ˜¯æŠŠæ‡‰ç”¨ç¨‹å¼çš„æ¯å€‹ã€Œç™¼ç”Ÿéçš„äº‹ä»¶ã€å­˜ä¸‹ä¾†ï¼Œä¸ç›´æ¥å­˜æœ€çµ‚çµæœï¼Œè®“ç³»çµ±å¯ä»¥å›æ”¾æ­·å²ã€é‡å»ºç‹€æ…‹ï¼Œä¸¦å…·å‚™æ¥µé«˜çš„å¯è¿½æº¯æ€§èˆ‡å½ˆæ€§ã€‚


> [!NOTE]
> ## ğŸ”„ å®ƒè·Ÿ Change Data Capture (CDC) æœ‰ä»€éº¼å·®åˆ¥ï¼Ÿ
> 
>
>
> |é …ç›®|Change Data Capture|Event Sourcing|
> |---|---|---|
> |è³‡æ–™æ€éº¼ä¾†|ç³»çµ±ç”¨å‚³çµ±è³‡æ–™åº«ï¼Œå¾Œé¢å·å·è¨˜ä¸‹æ”¹å‹•|ä¸€é–‹å§‹å°±è¨˜éŒ„ã€Œäº‹ä»¶ã€ï¼Œè³‡æ–™ä¾†æºå°±æ˜¯äº‹ä»¶|
> |è³‡æ–™æ€§è³ª|æ¯”è¼ƒä½éšã€åƒã€Œrow updateã€é€™ç¨®æ”¹å‹•|æ¯”è¼ƒé«˜éšã€åƒã€Œä½¿ç”¨è€…å–æ¶ˆèª²ç¨‹ã€é€™ç¨®è¡Œç‚º|
> |ç³»çµ±æ„è­˜|è³‡æ–™åº«è‡ªå·±é‹ä½œã€æ‡‰ç”¨ç¨‹å¼æ²’ç®¡é€™äº›æ”¹å‹•|æ‡‰ç”¨ç¨‹å¼è‡ªå·±ä¸»å‹•å¯«äº‹ä»¶é€² log|
> 

### State, Streams, and Immutability


## Processing Streams
å¦‚ä½•è™•ç†streamè³‡æ–™
1. å¯«å…¥è³‡æ–™åº«
2. é€šçŸ¥äººé¡ä½¿ç”¨è€…
3. è¼¸å‡ºå…¶ä»–stream

### Uses of Stream Processing
#### Complex event processing CEP
Cep æœ‰é»åƒrgexp
ç›£æ§streamï¼Œç™¼ç¾matchæ™‚ç™¼å‡ºcomplex event

#### Stream analytics
#### Maintaining materialized views
Materialized view æ˜¯æ ¹æ“šè³‡æ–™è®ŠåŒ–è€Œå³æ™‚æ›´æ–°çš„å¿«å–è¦–åœ–ï¼Œé€éäº‹ä»¶æµèˆ‡äº‹ä»¶æº¯æºæ–¹å¼ç¶­è­·å®ƒï¼Œå¯ä»¥å¯¦ç¾ä¸€è‡´æ€§ä¸”é«˜æ•ˆçš„æŸ¥è©¢ï¼ŒKafka Streams ç­‰å·¥å…·èƒ½å¹«åŠ©ä½ åšåˆ°é€™ä»¶äº‹ã€‚
#### Search on streams
ç‚ºæŸ¥è©¢å»ºç«‹ç´¢å¼•

> [!NOTE]
> ## ğŸ”§ å¯¦ä½œæƒ³åƒï¼šæŸ¥è©¢è¢«çµæ§‹åŒ–æˆã€Œå¯ç¯©é¸çš„æ¢ä»¶ç´¢å¼•ã€
> 
> å‡è¨­æœ‰ 10 è¬æ¢æŸ¥è©¢ï¼Œå¾ˆå¤šéƒ½è·ŸÂ `amount`Â æœ‰é—œï¼š
> 
>
>> |æŸ¥è©¢ ID|æ¢ä»¶ç‰‡æ®µ|
> |---|---|
> |Q1|amount > 100000|
> |Q2|amount BETWEEN 50000 AND 60000|
> |Q3|amount < 1000|
> 
> ç³»çµ±æœƒå…ˆå»ºä¸€å€‹Â **interval tree æˆ– B-tree**Â ä¾†è¨˜éŒ„æ‰€æœ‰æ¶‰åŠÂ `amount`Â æ¢ä»¶çš„æŸ¥è©¢ã€‚  
> ç•¶ä¸€ç­†äº‹ä»¶Â `amount = 80000`Â åˆ°ä¾†æ™‚ï¼Œç³»çµ±æœƒï¼š
> 
> 1. æŸ¥è©¢ç´¢å¼•ä¸­å“ªäº›æŸ¥è©¢æ¢ä»¶Â **å¯èƒ½æœƒå‘½ä¸­**ï¼ˆä¾‹å¦‚åŒ…å« 80000 çš„å€é–“ï¼‰ã€‚
>     
> 2. åƒ…å°é€™äº›æŸ¥è©¢é€²è¡Œå¾ŒçºŒæ¯”å°ï¼ˆå¦‚ regionã€æ™‚é–“ã€æ¬¡æ•¸æ¢ä»¶ç­‰ï¼‰ã€‚
>     
> 3. **è·³éå…¶é¤˜æ˜é¡¯ä¸æœƒå‘½ä¸­çš„æŸ¥è©¢**ï¼ˆå¦‚Â `amount > 100000`ï¼‰ï¼Œç¯€çœé‹ç®—è³‡æºã€‚

#### Message passing and RPC
Message passing è‘—é‡åœ¨ä½µç™¼èˆ‡æ¨¡çµ„æºé€šï¼Œstream processing è‘—é‡åœ¨è³‡æ–™æŒä¹…åŒ–èˆ‡è½‰æ›è™•ç†ã€‚é›–ç„¶å¯ä»¥äº’ç›¸å€Ÿé¡ï¼Œä½†å®ƒå€‘è§£æ±ºçš„æ˜¯ä¸åŒå±¤æ¬¡çš„å•é¡Œã€‚

### Reasoning About Time
#### Event time versus processing time
å¾ˆå¤šåŸå› èƒ½è®“è™•ç†è¢«å»¶é²ï¼Œç¶²è·¯éŒ¯èª¤ã€æ•ˆèƒ½ã€é‡å•Ÿã€‚

äº‹ä»¶ç™¼ç”Ÿçš„æ™‚é–“å¯èƒ½å¾ˆç©©å®šï¼Œä½†å› ç‚ºconsumeré‡å•Ÿï¼Œæœƒå°è‡´ä¸€æ®µæ™‚é–“é™¡é™ï¼Œä¸¦åœ¨ä¹‹å¾Œçš„ä¸€æ®µæ™‚é–“è™•ç†äº‹ä»¶çš„é »ç‡çˆ†å‡ã€‚
![600](https://github.com/Vonng/ddia/raw/main/img/fig11-7.png)


#### Knowing when youâ€™re ready
#### Whose clock are you using, anyway?
ä½¿ç”¨clientçš„æ™‚é–“ï¼šä¸å¯ä¿¡ï¼Œå¯èƒ½å› ç‚ºæ„å¤–æˆ–è“„æ„çš„å°è‡´æ™‚é–“ä¸æ­£ç¢º
ä½¿ç”¨serverçš„æ™‚é–“ï¼šæ­£ç¢ºï¼Œä½†æ˜¯æ¯”è¼ƒç„¡æ³•æè¿°ä½¿ç”¨æƒ…æ³

é€éä¸‰å€‹æ™‚é–“æˆ³ä¾†è™•ç†çš„å€‹å•é¡Œ
1. clientæ™‚é–“ï¼ševentç™¼ç”Ÿçš„æ™‚é–“
2. clientæ™‚é–“ï¼ševentç™¼é€çµ¦serverçš„æ™‚é–“
3. serveræ™‚é–“ï¼šæ”¶åˆ°eventçš„æ™‚é–“

#### Types of windows


### Stream Joins
æ‰€è¬‚çš„ streamã€table æ˜¯åœ¨æè¿°è³‡æ–™åœ¨ç³»çµ±ä¸­çš„è§’è‰²èˆ‡ç”Ÿå‘½é€±æœŸï¼›è€Œ join çš„è§¸ç™¼é»ï¼Œæ˜¯ stream ä¸­æ–°äº‹ä»¶çš„åˆ°ä¾†ï¼›è€Œé€™äº› join æ“ä½œæœƒå³æ™‚å»æŸ¥è©¢ç‹€æ…‹ï¼ˆtable æˆ–å¦ä¸€å€‹ streamï¼‰ä¾†ç”¢å‡ºæ–°è³‡æ–™ã€‚

> [!NOTE]
> ### âœ…Â **1. Streamâ€“Stream Joinï¼šäº‹ä»¶å°äº‹ä»¶çš„é—œè¯**
> ğŸ“ŒÂ **æƒ…å¢ƒï¼š**
> - å‡è¨­ä½ åœ¨åšä½¿ç”¨è€…è¡Œç‚ºåˆ†æï¼Œè§€å¯Ÿã€Œé»æ“Šå•†å“ã€èˆ‡ã€Œä¸‹å–®ã€ä¹‹é–“çš„é—œè¯ã€‚
> 
> ğŸ“…Â **ç¯„ä¾‹ï¼š**
> - åŒä¸€ä½ä½¿ç”¨è€…åœ¨ 30 åˆ†é˜å…§é»æ“Šå•†å“ Aï¼Œåˆä¸‹å–®å•†å“ A â†’ é€™å…©å€‹äº‹ä»¶å°±æœƒè¢« join åœ¨ä¸€èµ·ã€‚
> 
> ğŸ”Â **ç”¨é€”ï¼š**
> - åˆ†æè¡Œç‚ºè·¯å¾‘ã€åµæ¸¬ fraudï¼ˆä¾‹å¦‚çŸ­æ™‚é–“å…§å¤§é‡ç•°å¸¸æ“ä½œï¼‰
> 
> ### âœ…Â **2. Streamâ€“Table Joinï¼šå³æ™‚æŸ¥è©¢èƒŒæ™¯è³‡æ–™**
> ğŸ“ŒÂ **æƒ…å¢ƒï¼š**
> - ä¸€å€‹ä½¿ç”¨è€…ç™»å…¥äº‹ä»¶ï¼ˆstreamï¼‰ï¼Œä½ å¸Œæœ›è£œä¸Šè©²ç”¨æˆ¶çš„ VIP ç­‰ç´šæˆ–åœ°å€è³‡è¨Šï¼ˆtableï¼‰
> 
> ğŸ”Â **ç”¨é€”ï¼š**
> - enrichï¼ˆå¢è£œï¼‰äº‹ä»¶è³‡è¨Šï¼Œå¸¸ç”¨æ–¼ real-time recommendationã€event logging åŠ å…¥ user profile
> 
> ğŸ’¡Â **æŠ€è¡“ç­†è¨˜ï¼š**
> - ç‚ºäº†æ•ˆèƒ½ï¼Œé€šå¸¸ä¸æœƒæ¯æ¬¡éƒ½æŸ¥é ç«¯è³‡æ–™åº«ï¼Œè€Œæ˜¯é€éÂ **changelog stream â†’ local cache**Â ä¾†ç¶­è­· profile è³‡æ–™
> 
> ### âœ…Â **3. Tableâ€“Table Joinï¼šç¶­è­·å¯æŸ¥è©¢çµæœï¼ˆç‰©åŒ–è¦–åœ–ï¼‰**
> ğŸ“ŒÂ **æƒ…å¢ƒï¼š**
> - Twitter æƒ³è¦ç¶­è­·æ¯ä½ä½¿ç”¨è€…çš„ timelineï¼ˆä½  follow èª°ï¼Œä»–å€‘çš„ tweet å°±å‡ºç¾åœ¨ä½  timeline è£¡ï¼‰
> 
> ğŸ§©Â **è³‡æ–™è¡¨ï¼š**
> - Follows Tableï¼šèª° follow èª°
> - Tweets Tableï¼šèª°ç™¼äº†å“ªäº› tweet
> 
> ğŸ“ŠÂ **ç”¨é€”ï¼š**
> - ç•¶ follow / unfollow æˆ– tweet ç™¼é€æ™‚ï¼Œé¦¬ä¸Šæ›´æ–° timeline cache
> - å°æ‡‰åˆ° Materialized View çš„å³æ™‚ç¶­è­·ï¼š`SELECT * FROM tweets JOIN follows ...`
#### Stream-stream join (window join)
#### Stream-table join (stream enrichment)
#### Table-table join (materialized view maintenance)
#### Time-dependence of joins

> [!NOTE]
> ## â° æ™‚é–“ä¾è³´æ€§çš„æŒ‘æˆ°
> 
> é€™ä¸‰ç¨® Join éƒ½æœ‰ã€Œ**æ ¹æ“šä»€éº¼æ™‚é–“é»çš„ç‹€æ…‹ä¾†é€²è¡Œ join**ã€çš„å•é¡Œï¼š
> 
> ### ä¾‹å­ï¼š
> 
> - å‡è¨­æŸäººé»æ“Šäº†ä¸€ç¯‡æ¨è–¦æ–‡ç« 
>     
> - æ¨è–¦æ¨¡å‹ï¼ˆæˆ–ç”¨æˆ¶ profileï¼‰ä¹‹å¾Œæ›´æ–°äº†
>     
> - é‚£æˆ‘å€‘æ‡‰è©²ä»¥ã€Œ**é»æ“Šç•¶ä¸‹çš„æ¨¡å‹ç‰ˆæœ¬**ã€é‚„æ˜¯ã€Œ**æœ€æ–°çš„æ¨¡å‹ç‰ˆæœ¬**ã€ä¾†åˆ¤æ–·é€™æ¬¡æ¨è–¦æ˜¯å¦æˆåŠŸï¼Ÿ
>     
> 
> ### è§£æ³•ï¼ˆå¸¸è¦‹æ‰‹æ®µï¼‰ï¼š
> 
> - ä½¿ç”¨Â **slowly changing dimensionï¼ˆSCDï¼‰**ï¼šæ¯æ¬¡ profile æˆ– tax rate è®Šå‹•ï¼Œéƒ½ç”¢ç”Ÿæ–°ç‰ˆæœ¬èˆ‡ IDï¼Œè®“äº‹ä»¶è¨˜éŒ„ã€Œå®ƒç•¶ä¸‹çœ‹åˆ°çš„æ˜¯å“ªä¸€ç‰ˆã€
>     
> - é€™æ¨£å°±èƒ½ä½¿ join éç¨‹**å…·å‚™æ±ºå®šæ€§ï¼ˆdeterministicï¼‰**

| é¡å‹                 | Input A           | Input B           | ç‹€æ…‹ç¶­è­·                     | é©åˆæƒ…å¢ƒ               |
| ------------------ | ----------------- | ----------------- | ------------------------ | ------------------ |
| Stream-Stream Join | å¯¦æ™‚äº‹ä»¶              | å¯¦æ™‚äº‹ä»¶              | æœ€è¿‘ä¸€æ®µæ™‚é–“çš„äº‹ä»¶ï¼ˆWindowï¼‰        | CTR åˆ†æã€å»£å‘Šé»æ“Šè¡Œç‚º      |
| Stream-Table Join  | å¯¦æ™‚äº‹ä»¶              | Reference Table   | æœ¬åœ°å¿«å– + CDC æ›´æ–°            | ä½¿ç”¨è€…è¡Œç‚º + Profile é…å° |
| Table-Table Join   | Reference Table A | Reference Table B | æŒçºŒåŒæ­¥ç¶­è­· materialized view | å¿«å–æ™‚é–“è»¸ã€æ¨è–¦åˆ—è¡¨         |

### Fault Tolerance
  Batch processingçš„éŒ¯èª¤è™•ç†å¾ˆç°¡å–®ï¼Œåªè¦é‡ç®—ä¸€æ¬¡å°±å¥½ã€‚
  è™•ç†å®Œç•¢æ™‚ï¼Œä½¿output file visibleã€‚ä½†æ˜¯streamä¸æœƒæœ‰è™•ç†å®Œçš„æ™‚å€™ï¼Œä»–æ˜¯ç„¡é™çš„ã€‚

#### Microbatching and checkpointing
å°batchçš„å°ºå¯¸å·®ä¸å¤šåœ¨1ç§’ã€‚å¤ªå¤§æœƒå°è‡´delayï¼Œå¤ªå°æœƒå°è‡´overheadã€‚

ä½†æ˜¯å¦‚æœå‡ºéŒ¯çš„è©±ï¼Œå·²ç¶“å¯«å…¥çš„éƒ¨åˆ†å°±ç„¡æ³•è¢«æ¨æ£„äº†ã€‚

#### Atomic commit revisited
åœ¨é™åˆ¶ç’°å¢ƒä¸‹å¯å¯¦è¸ã€‚
Google Cloud Dataflow and VoltDB

#### Idempotence
å†ªç­‰æ€§

#### Rebuilding state after a failure
å¯èƒ½å°‡stateå„²å­˜èµ·ä¾†ï¼Œæˆ–æ˜¯replay stream


### Summary
#### AMQP/JMS-style message broker
å¤šå€‹consumer
message è¢« ack ä¹‹å¾Œå°±æœƒè¢«åˆªæ‰

é©åˆé †åºä¸é‡è¦ï¼Œä¸éœ€è¦é‡æ–°è®€å–çš„å ´æ™¯

#### Log-based message broker
ä¸€å€‹partionæŒ‡æ´¾çµ¦ä¸€å€‹consumer node
é©åˆéœ€è¦ç”¢ç”Ÿè¡ç”Ÿè³‡æ–™çš„å ´æ™¯

