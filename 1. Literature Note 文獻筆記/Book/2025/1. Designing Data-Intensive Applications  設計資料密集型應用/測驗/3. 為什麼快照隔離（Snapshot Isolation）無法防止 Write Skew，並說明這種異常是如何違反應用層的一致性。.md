---
tags: []
date: 2025-06-11
time: 22:44
---
write skew來自acid的consistency被違背了，但是快照隔離無法偵測到這個情況，所導致的異常。經典的例子就是我們需要維持至少有一名醫生在職勤，這是藉由統計目前執勤人數才能判斷的條件，而快照隔離只能偵測被寫入的單一資料項有無衝突，所以無法偵測到。

### 問題與可加強之處

- **「來自 ACID 的 Consistency 被違背」**：要更明確指出是不變式（invariant）被破壞，而非泛指 Consistency。
    
- **衝突檢測機制描述可更精準**：Snapshot Isolation 只檢查「同一行的寫寫衝突」，對跨行、跨筆的寫入無法偵測。
    

### 改進版簡答

> **Snapshot Isolation** 會讓每個事務從同一時間點讀取快照，並在 commit 前檢查「要寫入的資料行」是否已被其他事務改寫：若有相同的行被修改，就 abort。
> 
> **Write Skew** 則是兩個事務各修改不同的行，但都基於同一快照做業務邏輯判斷，最後破壞了應用層定義的不變式（invariant）。因為它們沒寫同一行，SI 的衝突檢查不會發現問題，就會都 commit。
> 
> **醫生排班範例**
> 
> - 不變式：一天之內至少有一名醫生在院。
>     
> - T1 讀到 A=true、B=true，決定把 A 設為 false；
>     
> - T2 幾乎同時也讀到同樣快照，決定把 B 設為 false；
>     
> - 因為沒修改同一行，兩者都能 commit，結果 A=false、B=false，違反了「至少一人值班」的不變式。
>