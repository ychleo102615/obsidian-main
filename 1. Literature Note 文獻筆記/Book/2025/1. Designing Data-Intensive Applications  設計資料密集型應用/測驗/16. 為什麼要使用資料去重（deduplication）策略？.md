---
tags: []
date: 2025-07-12
time: 22:14
---
題目：在分散式資料系統中，為什麼要使用資料去重（deduplication）策略？請說明常見去重技術的實作方式，以及它們在保證「至少一次交付」（at-least-once delivery）語意下的重要性。 回答：在系統的不同節點中，我們如果使用網路通訊來溝通，常常會有送了資料卻沒有回應的問題。此時我們常用的做法是再送一次。因此接受資料的那一側有可能會收到同一筆資料兩次，那就會需要忽略重複的那一次。常見的去重技巧是為該次交互加入版本號，所以如果當收到的資料的版本號已經出現過了，就代表應該要忽略。


在分散式系統中，採用「至少一次交付」（at-least-once delivery）的訊息保證雖然能提高可用性，但也可能導致**同一筆訊息被送到消費端多次**。如果不做去重，這些重複訊息就會被「重播」成多筆相同的操作，破壞最終一致性和業務正確性。

## 去重在 at-least-once 語意下的重要性

- **確保業務正確性**：如金融交易、訂單處理，重複操作會導致金額重扣、重複發貨等嚴重後果。
    
- **提升用戶體驗**：避免重複通知、重複推播等怪異行為。
    
- **維持系統健全**：防止累計指標、統計報表被重複累加，影響決策。


|技術|優點|缺點|
|---|---|---|
|全局唯一 ID + 去重儲存|絕對不重複，原理簡單|去重儲存空間大，查詢性能要考量；布隆過濾器有誤判風險|
|序號範圍滑動視窗|空間小，只保留滑窗內序號|亂序或序號跳躍大時誤判；不適合多生產者–多消費者混合場景|
|主鍵約束／Idempotent Writes|利用資料庫索引去重，無需獨立去重儲存|唯一鍵衝突性能負擔；需設計 idempotent schema|

每次只要是「允許重傳／重播，但又不能重複執行作業」的場景，就要想到去重：在開發流處理、事件驅動或分散式交易系統時，均屬此列。