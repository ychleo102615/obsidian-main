---
tags: []
date: 2025-06-12
time: 21:46
---
##### 我的回答
WAL有兩個好處，一個是當事務先寫在WAL上，而不是直接寫入資料庫，這樣abort時會比較方便，直接處理WAL就行。另一個是這方便複製到replica上。 WAL的基本概念是將對資料庫的寫入操作都先以log的形式記錄下來，還不應用在持久性資料，也就是磁碟上，等之後確定了才真正寫入


#### 回饋
你的要點都抓到了，但可以再補充與精準化一下：
1. **WAL 的基本概念**
    - WAL（Write-Ahead Log）是指「在把資料頁（data page）寫回磁碟之前，先把事務的所有變更記錄（log record）以順序追加的方式，寫入一個專用的日誌檔」。
    - 這個日誌檔通常只做「追加」（append），保證了最少的隨機 I/O，寫入效能很高。
2. **為什麼能簡化 Abort（回滾）？**
    - 日誌中除了記錄新值（redo）之外，還會記錄舊值（undo），以便事務需要回滾時，只要根據 undo log 把資料頁恢復到原本狀態即可。
    - 而且因為所有變更都已經在日誌裡了，資料頁若還沒寫回，完全不用理會那些尚未刷到磁碟的頁面。
3. **持久性（Durability）保障**
    - 在事務 commit 時，只要確保 WAL 已經被刷到磁碟，就能保證即使系統當機，重啟後通過 replay 這些 log，就能把所有已提交的變更都應用回去，達成「一旦回報成功，就永遠不會丟失」的 Durability。
4. **順序寫入帶來的效能**
    - 相較於直接更新資料頁可能是隨機 I/O，WAL 的純追加操作可以累積批次 flush，極大提升寫入吞吐。
5. **複製（Replication）上的好處**
    - 主庫只要把 WAL 的内容推送（log shipping）或即時複製給從庫，從庫就能按相同的順序 replay 同樣的 log，快速同步狀態。