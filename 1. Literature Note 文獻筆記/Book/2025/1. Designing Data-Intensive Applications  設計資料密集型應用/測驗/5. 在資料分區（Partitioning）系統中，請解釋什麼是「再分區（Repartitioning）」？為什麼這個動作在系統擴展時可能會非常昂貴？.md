---
tags: []
date: 2025-06-13
time: 21:26
---
##### 我的回答
再分區是指當資料在多個分區之中分配的太不均勻時，得重新分配部分的分區的狀況。這涉及搬移大量資料，更新分區索引的算法，所以昂貴。

#### 回饋
1. **再分區的定義**
    > 再分區（Repartitioning）不只是因為「分配不均」才做，當你要增加或減少分區節點（shard／broker／機器）時，也必須把原本的資料重新映射到新的分區布局。
2. **為何昂貴**
    - **大量網路 I/O**：要把整個 key 範圍／hash 範圍裡的資料從舊節點搬到新節點，往往涉及成 GB、TB 級別的資料傳輸。
    - **磁碟與 CPU 負載**：資料從磁碟讀出、序列化、再寫入另一台機器；同時還要更新索引、壓縮與校驗，CPU 與 I/O 壓力都很大。
    - **元資料更新**：系統中每個路由層、負載平衡器、客戶端都要同步拿到新的分區映射（partition map），否則請求就會亂送。這又是一筆協調成本。
    - **一致性保障**：如果要在遷移過程中仍舊提供讀寫服務，需要額外機制（如雙寫、多版本或暫時加鎖），以避免搬一半就造成缺漏或重複。這些機制本身也會消耗資源並拖慢整體效能。

**補充說明**
- 有些系統用 **一致性 Hashing（Consistent Hashing）** 來減少再分區時搬移的範圍，但仍然不可避免要搬動一部分資料。
- **線上再分區**（online repartitioning）通常還要搭配流量控制（rate limiting）與節點健康檢測，確保重平衡不會打壞現有查詢。

這些原因合起來，就讓再分區在大規模系統中成為一件既耗時又耗資源的重工作。