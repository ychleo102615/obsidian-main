---
tags: []
date: 2025-06-23
time: 22:59
---
題目：在分散式資料庫的複寫（replication）策略中，leader-based replication 與 multi-leader replication 各有哪些優缺點？請簡要說明在什麼場景下適合使用 multi-leader replication。 

回答：single leader based replication顧名思義，我們只會有一個leader，這麼做的好處是保證不會有併發的問題，例如A, B兩人同時想對計數器加一，multi leader的情況可能導致最終只有得到加一，而不是預期的加二。缺點是所有的寫入都得由同一個節點來處理，降低寫入吞吐量。multi leader反之就是能更提高寫入吞吐量，並且能讓客戶不受地理位置影響太多響應時間，提高可用性。缺點就是要小心處理併發、衝突等問題。

## Leader-Based Replication（單一主節點複寫）

- **優點**
    
    1. **強一致性保證**：所有寫操作都集中到同一個 leader，按順序執行，從而避免寫寫衝突，不需要額外的衝突解決邏輯。
        
    2. **實作簡單**：複製流程清晰──leader 將變更 log 發送給 follower，follower 依序應用即可。
        
- **缺點**
    
    1. **單點寫入瓶頸**：所有寫入都要跑到同一台 leader，當寫負載很高時，leader 容易成為性能瓶頸。
        
    2. **可用性依賴 leader**：如果 leader 宕機，需要進行 leader 選舉，期間系統寫入不可用。
        

---

## Multi-Leader Replication（多主節點複寫）

- **優點**
    
    1. **寫入分散**：多個節點都接受寫入，寫負載能水平擴展，適合高寫入吞吐需求。
        
    2. **地理就近寫入**：每個區域可部署一個 leader，客戶端就近寫，降低跨區延遲，提高可用性。
        
    3. **容錯性更好**：單個 leader 宕機不影響整體寫入，只要還有其他 leader 存活，系統就可繼續接收寫操作。
        
- **缺點**
    
    1. **衝突風險**：多個 leader 同時修改相同資料時會產生寫寫衝突，需要額外的衝突偵測與解決機制（如 last-write-wins、應用層合併邏輯或 CRDT）。
        
    2. **一致性較弱**：若不特別設計，很難保證強一致性；通常只能提供最終一致性或可配置的隔離級別。
        
    3. **實作與運維複雜**：需要追蹤各 leader 的同步狀態與衝突情況，部署與故障排查比單一 leader 複雜。
        

---

## 什麼時候適合用 Multi-Leader Replication？

- **地理分散的全球應用**：像跨國電商、遊戲後端，需要在多個地區就近寫入，以獲得低延遲。
    
- **高寫入吞吐場景**：寫操作量非常巨大，單一節點已無法承擔，且能接受最終一致性的業務（如用戶行為日誌）。
    
- **高可用性需求**：希望在部分節點或區域故障時，系統仍可繼續寫入，並在問題修復後自動同步。
    

---

**總結**：

- 若寫入量中等、需要強一致性、且能容忍短暫 leader 切換，選 **Leader-Based**。
    
- 若寫入量極高、全域低延遲和高可用優先、且能接受衝突解決與最終一致性的複雜度，選 **Multi-Leader**。