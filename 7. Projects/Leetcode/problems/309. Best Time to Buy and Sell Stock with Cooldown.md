---
tags:
  - 2D-dp
date: 2025-01-02
time: 23:06
---
https://leetcode.com/problems/best-time-to-buy-and-sell-stock-with-cooldown/description/
[Best Time to Buy And Sell Stock With Cooldown](https://neetcode.io/problems/buy-and-sell-crypto-with-cooldown)

這題是在neetcode上面看到的。
我自己想了一陣子，只有想出像`(0,2), (3,5)`這樣買進、賣出元組，線性的去處理。如果前後組的間隔沒有超過一天，則要挑其中者回退。若被回退的元組變成買賣同一天的話，則要刪出。
總之想到這裡，就覺得太過於複雜了，就放棄，去看解答了。

在解答yt下面看到別人貼了這個答案：
```python
sold, held, reset = 0, -prices[0] , 0 
for price in prices[1:]: 
	held = max(held, reset - price) 
	reset = max(reset, sold) 
	sold = held + price 
return max(sold, reset)
```

> [!NOTE]- chatgpt
> 這段程式碼用於解決 LeetCode 309 題，**Best Time to Buy and Sell Stock with Cooldown**，主要是透過動態規劃（Dynamic Programming, DP）來處理問題。題目要求找到最大利潤，並且在賣出股票後需要有一天冷卻期，這段程式碼基於以下三個狀態進行轉移：
> 
> ### 三個狀態
> 
> 1. **held**: 持有股票的最大利潤。
>     
>     - 表示當天持有一支股票時的最大利潤。
>     - 初始化為 `-prices[0]`，因為在第一天購買股票的成本是負的。
> 2. **sold**: 不持有股票且當天剛賣出股票的最大利潤。
>     
>     - 表示當天剛賣出股票後的最大利潤。
>     - 初始化為 0，因為在第一天不可能有賣出行為。
> 3. **reset**: 不持有股票且處於冷卻期的最大利潤。
>     
>     - 表示當天處於冷卻期的最大利潤。
>     - 初始化為 0，因為在第一天不可能有冷卻期。
> 
> ---
> 
> ### 狀態轉移
> 
> 在遍歷價格數組時，我們通過以下邏輯更新每個狀態：
> 
> 1. **更新 `held`**:
>     
>     - 表示今天持有股票的狀態，可能來自於昨天就已經持有（`held`），或者今天購買了一支股票（`reset - price`）。
>     - 更新公式：`held = max(held, reset - price)`。
> 2. **更新 `reset`**:
>     
>     - 表示今天不持有股票且處於冷卻期的狀態，可能來自於昨天處於冷卻期（`reset`），或者昨天剛賣出股票（`sold`）。
>     - 更新公式：`reset = max(reset, sold)`。
> 3. **更新 `sold`**:
>     
>     - 表示今天不持有股票且今天剛賣出的狀態，只能來自於昨天持有股票並在今天賣出（`held + price`）。
>     - 更新公式：`sold = held + price`。
> 
> ---
> 
> ### 為什麼這段程式碼有效？
> 
> #### 冷卻期的影響
> 
> 冷卻期的約束被隱式地體現了，因為只有 `reset` 狀態才能允許再次購買股票，而 `reset` 是來自於前一天的 `sold` 或 `reset` 狀態。
> 
> #### 最優解的選擇
> 
> 遍歷完所有價格後，我們可以從兩個狀態中選擇最大利潤作為結果：
> 
> - `sold`: 股票在最後一天被賣出。
> - `reset`: 股票未被賣出，但處於冷卻期。
> 
> 因此，返回值是 `max(sold, reset)`。
> 
> ---
> 
> ### 時間與空間複雜度
> 
> - **時間複雜度**: O(n)O(n)，因為我們只遍歷一次價格數組。
> - **空間複雜度**: O(1)O(1)，因為我們只使用了常數額外空間來存儲狀態。

這題被neetcode歸類在2D DP的問題，這個DP是 `prices(n) * boolean`，空間上也就是O(2n)。
解題思路，我看作者一開始是畫出dfs所有的可能性，類似binary tree的方式去把所有可能性展開。