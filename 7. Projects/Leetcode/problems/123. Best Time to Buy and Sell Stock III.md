---
tags:
  - leetcode_hard
date: 2024-03-20
time: 21:45
---
[link](https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iii/)


[[2025-08-19|2025-08-19 Tue, 23:16]]

> [!我請GPT確認的回答]
> 無論如何，我都要計算 0 ~ i-1, i ~ n -1 的最佳獲利。
> 只是一般的思路是由左至右的掃描，如同第121題，從 0 ~ i -1 時，我們其實也正在算0 ~ i - 1的最佳獲利。
> 剩下的i ~ n - 1的獲利，如果從左至右出發的話，我們算的是 i ~ i + 1, i ~ i+2 .... i ~ n - 1的獲利，過程記錄的其實不是我們想要的（硬算的話，好像會讓時間複雜度升到O(n^2)），那還不如倒過來由後往前算，剛好就是 n - 2 ~ n - 1, n - 3 ~ n - 1..... i ~ n - 1，才是我們真正需要的另外一半子問題的解答。

|子問題|掃描方向|維護值|描述|
|---|---|---|---|
|第一次交易：`0 ~ i-1`|左→右|prefix min|最便宜的買入價|
|第二次交易：`i ~ n-1`|右→左|suffix max|最貴的賣出價|

你正確看出來的重點就是：

> **選擇 prefix 還是 suffix，完全來自你需要解哪個子區間，以及那個區間能否在當下維護到正確的值。**

---

## 💡 把它總結成一個小原則句型：

> 🧠「如果我要處理的是以 i 為**起點**的所有子區間，那我最好就從右往左，才能即時維護未來狀態（suffix）。」  
> 🧠「如果我要處理的是以 i 為**終點**的所有子區間，那我就從左往右，累積過去狀態（prefix）。」


---

在解這一題的過程中，感覺走歪了很多路。

但首先，hard的核心部分有被我想出來，idea是在找出單一次最大買賣後，向其前、中、後方向，再去計算哪邊可以獲得更多利潤（總共只能買賣兩次，除最大的那次後就是第二次記算的）。

**但是**，計算單一最大利潤買賣的功能，被我忘記要怎麼解了。這甚至是其姐妹題[121](https://leetcode.com/problems/best-time-to-buy-and-sell-stock/)。
走歪的部分，主要是我以為之前的解法，是從前後夾算最大最小值，但後來還是看了121的解答才搞清楚的。

希望這題整個解法以後不要忘記了。