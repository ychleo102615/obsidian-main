---
tags: dailies  
date: 2024-12-09
create: 2024-12-09-週一
time: 09:40
create: <% tp.date.now("YYYY-MM-DD-ddd") %>
---
## Log
---


## Note
---
今天遇到一個問題，我覺得或許在以後若有面試什麼時候的，可以分享遇到的問題。
[chatgpt](https://chatgpt.com/share/6756ab92-6d1c-8008-a85b-322b2acd9fa4)

基本上是使用state pattern與clean architecture, DDD之間的衝突。因為我想將state視為領域的一部分，使用state pattern與CA, DDD 會有衝突的感覺。

我認為處理的方式是，要看state對領域的影響有多大。
有很大的影響的話，state pattern整個應用於entity層中應該是沒問題的。但控制流仍然


> [!NOTE]
> state pattern本身就是把工作細節委派出去給state的一種模式，但是今天我們想在clean architecture, DDD中將state視為高階層的領域模型的話，等於是把這些細節轉給等級高的階層，這本身就是矛盾的行為不是嗎？
> 
> ###### ChatGPT 說：
> 
> ChatGPT
> 
> 你的觀察非常敏銳！這確實揭示了 **State Pattern** 和 **Clean Architecture/DDD** 在責任分配上的一個潛在矛盾點：
> 
> 1. **State Pattern** 的核心目的是：
>     
>     - 把與某狀態相關的行為細節封裝進具體的 `State` 類。
>     - 解耦狀態間的業務邏輯，讓主體對象（如 `Order`）能夠動態切換狀態。
> 2. **Clean Architecture 和 DDD** 的核心原則是：
>     
>     - 業務邏輯集中在領域層，而外部細節或技術性代碼（如狀態切換的內部實現）應位於低層次（應用層或基礎設施層）。
>     - 高層次的領域模型不應該依賴低層次的實現細節。
> 
> ### **矛盾點**
> 
> 在典型的 **State Pattern** 中：
> 
> - `State` 負責特定狀態的行為邏輯，並且有時會涉及到狀態切換的流程控制。
> - 如果把 `State` 抽象為領域層的一部分，則可能將狀態切換的「細節」提升到了高層次，這會違背 Clean Architecture/DDD 的設計原則。
> 
> ---
> 
> ### **如何解決這個矛盾？**
> 
> 要解決這個問題，需要在以下兩個方面做取捨和平衡：
> 
> 1. **State Pattern 的應用深度**
>     
>     - 是否真的需要將所有狀態細節封裝到 `State` 中？
>     - 還是只將狀態相關的業務邏輯封裝進 `State`，而把狀態切換的責任留在應用層？
> 2. **State 在 DDD 中的角色定位**
>     
>     - `State` 是一個業務概念（屬於領域模型）還是一種技術實現（應用層工具）？

<< [[<% fileDate = moment(tp.file.title, 'YYYY-MM-DD').subtract(1, 'd').format('YYYY-MM-DD') %>|Yesterday]] | [[<% fileDate = moment(tp.file.title, 'YYYY-MM-DD').add(1, 'd').format('YYYY-MM-DD') %>|Tomorrow]] >>